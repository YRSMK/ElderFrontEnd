/*!
 * Validetta (http://lab.hasanaydogdu.com/validetta/)
 * Version 1.0.0 ( 09-07-2014 )
 * Licensed under MIT (https://github.com/hsnayd/validetta/blob/master/LICENCE)
 * Copyright 2013-2014 Hasan AydoÄŸdu - http://www.hasanaydogdu.com 
 */
!function(a){"use strict";var b={},c={},d=new RegExp(/^(minChecked|maxChecked|minSelected|maxSelected|minLength|maxLength|equalTo|custom|remote)\[(\w{1,15})\]/i),e=new RegExp(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/),f=new RegExp(/^[\-\+]?(\d+|\d+\.?\d+)$/),g={required:"This field is required. Please be sure to check.",email:"Your E-mail address appears to be invalid. Please be sure to check.",number:"You can enter only numbers in this field.",maxLength:"Maximum {count} characters allowed!",minLength:"Minimum {count} characters allowed!",maxChecked:"Maximum {count} options allowed. Please be sure to check.",minChecked:"Please select minimum {count} options.",maxSelected:"Maximum {count} selection allowed. Please be sure to check.",minSelected:"Minimum {count} selection allowed. Please be sure to check.",notEqual:"Fields do not match. Please be sure to check.",creditCard:"Invalid credit card number. Please be sure to check."},h={display:"bubble",errorTemplateClass:"validetta-bubble",errorClass:"validetta-error",validClass:"validetta-valid",errorClose:!0,errorCloseClass:"validetta-bubbleClose",realTime:!1,onValid:function(){},onError:function(){},custom:{},remote:{}},i=function(a){return"string"==typeof a?a.replace(/^\s+|\s+$/g,""):a},j={required:function(a,b){switch(a.el.type){case"checkbox":return a.el.checked||g.required;case"radio":return this.radio.call(b,a.el)||g.required;case"select-multiple":return null!==a.val||g.required;default:return""!==a.val||g.required}},email:function(a){return e.test(a.val)||g.email},number:function(a){return f.test(a.val)||g.number},minLength:function(a){var b=a.val.length;return 0===b||b>=a.arg||g.minLength.replace("{count}",a.arg)},maxLength:function(a){return a.val.length<=a.arg||g.maxLength.replace("{count}",a.arg)},equalTo:function(b,c){return a(c.form).find('input[name="'+b.arg+'"]').val()===b.val||g.notEqual},creditCard:function(a){if(""===a.val)return!0;var b,c,d,e,f,h,i,j=0;if(b=new RegExp(/[^0-9]+/g),c=a.val.replace(b,""),i=c.length,16>i)return g.creditCard;for(f=0;i>f;f++)d=i-f,e=parseInt(c.substring(d-1,d),10),f%2===1?(h=2*e,h>9&&(h=1+(h-10))):h=e,j+=h;return j>0&&j%10===0?!0:g.creditCard},maxChecked:function(b,c){var d=a(c.form.querySelectorAll('input[type=checkbox][name="'+b.el.name+'"]'));if(0===d.index(b.el)){var e=d.filter(":checked").length;if(0!==e)return e<=b.arg||g.maxChecked.replace("{count}",b.arg)}},minChecked:function(b,c){var d=a(c.form.querySelectorAll('input[type=checkbox][name="'+b.el.name+'"]'));if(0===d.index(b.el)){var e=d.filter(":checked").length;return e>=b.arg||g.minChecked.replace("{count}",b.arg)}},maxSelected:function(a){return null!==a.val?a.val.length<=a.arg||g.maxSelected.replace("{count}",a.arg):void 0},minSelected:function(a){return null!==a.val&&a.val.length>=a.arg||g.minSelected.replace("{count}",a.arg)},radio:function(b){var c=a(this.form.querySelectorAll('input[type=radio][name="'+b.name+'"]')).filter(":checked").length;return 1===c},custom:function(a,b){var c=b.options.custom[a.arg],d=new RegExp(c.pattern);return d.test(a.val)||c.errorMessage},remote:function(a){a.remote=a.arg}};b=function(b,c){this.handler=!1,this.options=a.extend(!0,{},h,c),this.form=b,this.xhr={},this.events()},b.prototype={constructor:b,events:function(){var b=this;a(this.form).submit(function(a){return c=this.querySelectorAll("[data-validetta]"),b.init(a)}),this.options.realTime===!0&&(a(this.form).find("[data-validetta]").not("[type=checkbox]").on("change",function(d){return c=a(this),b.init(d)}),a(this.form).find("[data-validetta][type=checkbox]").on("click",function(a){return c=b.form.querySelectorAll('[data-validetta][type=checkbox][name="'+this.name+'"]'),b.init(a)})),a(this.form).on("reset",function(){return a(b.form.querySelectorAll("."+b.options.errorClass+", ."+b.options.validClass)).removeClass(b.options.errorClass+" "+b.options.validClass),b.reset()}),this.options.errorClose&&a(this.form).on("click","."+this.options.errorCloseClass,function(){var a=this.parentNode;return a&&b.window.close.call(b,a),!1})},init:function(a){return this.reset(c),this.checkFields(a),"submit"!==a.type?void 0:"pending"===this.handler?!1:this.handler===!0?(this.options.onError.call(this,a),!1):this.options.onValid.call(this,a)},checkFields:function(b){for(var e=this,f=c.length-1;f>=0;f--){var g,h=c[f],k="",l=i(a(h).val()),m=h.getAttribute("data-validetta").split(",");this.tmp={},this.tmp={el:h,val:l,parent:h.parentNode};for(var n=m.length-1;n>=0;n--){var o,p=m[n].match(d);null!==p?("undefined"!=typeof p[2]&&(this.tmp.arg=p[2]),o=p[1]):o=m[n],(""!==l||"required"===o||"equalTo"===o)&&j.hasOwnProperty(o)&&(g=j[o](e.tmp,e),"undefined"!=typeof g&&g!==!0&&(k+=g+"<br/>"))}""!==k?(this.addErrorClass(this.tmp.parent),this.window.open.call(this,h,k)):"undefined"!=typeof this.tmp.remote?this.checkRemote(h,b):("undefined"!=typeof g?this.addValidClass(this.tmp.parent):a(this.tmp.parent).removeClass(this.options.errorClass+" "+this.options.validClass),g=void 0)}},checkRemote:function(b,c){var d={},e={},f=b.name||b.getAttribute("id");"undefined"==typeof this.remoteCache&&(this.remoteCache={}),e[f]=this.tmp.val,d=a.extend(!0,{},{data:e},this.options.remote[this.tmp.remote]||{});var g=a.param(d),h=this.remoteCache[g];if("undefined"!=typeof h)switch(h.state){case"pending":this.handler="pending",h.event=c.type;break;case"rejected":throw c.preventDefault(),new Error(h.result.message);case"resolved":h.result.valid===!1?(this.addErrorClass(this.tmp.parent),this.window.open.call(this,b,h.result.message)):this.addValidClass(this.tmp.parent)}else{var i=this.xhr[f];"undefined"!=typeof i&&"pending"===i.state()&&i.abort(),h=this.remoteCache[g]={state:"pending",event:c.type},this.remoteRequest(d,h,b,f)}},remoteRequest:function(b,c,d,e){var f=this;a(this.tmp.parent).addClass("validetta-pending"),this.xhr[e]=a.ajax(b).done(function(b){b=JSON.parse(b),c.state="resolved",c.result=b,"submit"===c.event?(f.handler=!1,a(f.form).trigger("submit")):b.valid===!1?(f.addErrorClass(f.tmp.parent),f.window.open.call(f,d,b.message)):f.addValidClass(f.tmp.parent)}).fail(function(a,b){if("abort"!==b){var d="Ajax request failed for field ("+e+") : "+a.status+" "+a.statusText;throw c.state="rejected",c.result={valid:!1,message:d},new Error(d)}}).always(function(){a(f.tmp.parent).removeClass("validetta-pending")}),this.handler="pending"},window:{open:function(b,c){var d=b.parentNode;if("undefined"==typeof d&&(d=b[0].parentNode),!a(d).find("."+this.options.errorTemplateClass).length){var e=document.createElement("span");if(e.className=this.options.errorTemplateClass,"bubble"===this.options.display){var f,g;f=a(b).position(),g=a(b).outerWidth(!0),a(e).empty().css({left:f.left+g+15+"px",top:f.top+"px"})}if(d.appendChild(e),e.innerHTML=c,this.options.errorClose){var h=document.createElement("span");h.innerHTML="x",h.className=this.options.errorCloseClass,e.appendChild(h)}this.handler=!0}},close:function(a){a.parentNode.removeChild(a),this.handler=!1}},reset:function(b){var c={};c="undefined"==typeof b||b.length>1&&"checkbox"!==b[0].getAttribute("type")?a(this.form).find("."+this.options.errorTemplateClass):a(b[0].parentNode).find("."+this.options.errorTemplateClass);for(var d=c.length-1;d>=0;d--)this.window.close.call(this,c[d])},addErrorClass:function(b){a(b).removeClass(this.options.validClass).addClass(this.options.errorClass)},addValidClass:function(b){a(b).removeClass(this.options.errorClass).addClass(this.options.validClass)}},a.fn.validetta=function(c){return a.validettaLanguage&&(g=a.extend(!0,{},g,a.validettaLanguage.messages)),this.each(function(){new b(this,c)})}}(jQuery);